#include <stdio.h>
#include <math.h>
#include <time.h>
#include "utils.h"
#include "PSOLA.h"
#include "arrays_psola.h"
#include "pitch_detection.h"
#include "FLWT.h"
 
#define WINDOWLEN	512

int16_t test[] = {0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6,0,6,10,10,6,0,-6,-10,-10,-6};
int16_t peaks[1024];

int main(void)
{
//    rt_buffer rt_input;     // Este hay que asociarlo con el ADC, es lo que procesa PSOLA
//    rt_buffer rt_output;    // Este hay que asociarlo con el DAC, es la salida de PSOLA
	
    printf("PSOLA Testing\n");
    float fs = 1000.0f;
    
    uint16_t peaks_len = find_peaks(test, 2000, peaks , fs);
    float detected_pitch = get_fundamental(peaks, 1024, fs);
    
    printf("Detected Pitch of windows = %f \n", detected_pitch); 
    
    return 0;
}
